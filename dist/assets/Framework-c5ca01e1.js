import{j as G,r as v,ag as f,o as l,c as p,a as t,F as j,V as r,P as d,T as E,a3 as X,U as N,n as Y,a8 as J,O as B,S as M,J as T,K as W,u as O,bb as Z,b9 as ee,w as re,R as ie}from"./@vue-3886a262.js";import{u as H,b as K}from"./vue-router-6d9ab4b6.js";import{S as ue}from"./spark-md5-66a43a5d.js";import{_ as te}from"./index-db517136.js";import"./aplayer-585df14e.js";import"./element-plus-485a4a99.js";import"./lodash-es-36eb724a.js";import"./@vueuse-08bf1a74.js";import"./@element-plus-4ca69592.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-5d216acc.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-9626137c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-8a8891e3.js";import"./vue-cookies-fc2d14d9.js";import"./@highlightjs-e10ea536.js";import"./highlight.js-6845818c.js";import"./axios-4a70c6fc.js";import"./docx-preview-8cc7001d.js";import"./jszip-1f4bc9a3.js";import"./xlsx-74460a39.js";import"./vue-pdf-embed-608804e8.js";import"./vue-0ba3f033.js";import"./dplayer-d4a41b2a.js";import"./vue-clipboard3-6d269bab.js";import"./clipboard-65322c36.js";const ce={class:"avatar-upload"},de={class:"avatar-show"},pe=["src"],_e=["src"],me=["src"],ve={class:"select-btn"},fe={__name:"AvatarUpload",props:{modelValue:{type:Object,default:null}},setup(w,{emit:g}){G(),H(),K(),v("");const F=v(null),x=async u=>{u=u.file;let e=new FileReader;e.readAsDataURL(u),e.onload=({target:_})=>{F.value=_.result},g("update:modelValue",u)};return(u,e)=>{const _=f("el-button"),A=f("el-upload");return l(),p("div",ce,[t("div",de,[F.value?(l(),p("img",{key:0,src:F.value},null,8,pe)):(l(),p(j,{key:1},[w.modelValue&&w.modelValue.qqAvatar?(l(),p("img",{key:0,src:`${w.modelValue.qqAvatar}`},null,8,_e)):(l(),p("img",{key:1,src:`/api/getAvatar/${w.modelValue.userId}`},null,8,me))],64))]),t("div",ve,[r(A,{name:"file","show-file-list":!1,accept:".png,.PNG,.jpg,.JPG,.jpeg,.JPEG,.gif,.GIF,.bmp,.BMP",multiple:!1,"http-request":x},{default:d(()=>[r(_,{type:"primary"},{default:d(()=>[E("选择")]),_:1})]),_:1})])])}}},he={__name:"UpdateAvatar",emits:["updateAvatar"],setup(w,{expose:g,emit:F}){const{proxy:x}=G();H(),K();const u={updateUserAvatar:"updateUserAvatar"},e=v({}),_=v();g({show:I=>{e.value=Object.assign({},I),e.value.avatar={userId:I.userId,qqAvatar:I.avatar},S.value.show=!0}});const S=v({show:!1,title:"修改头像",buttons:[{type:"primary",text:"确定",click:I=>{z()}}]}),z=async()=>{if(!(e.value.avatar instanceof File)){S.value.show=!1;return}if(!await x.Request({url:u.updateUserAvatar,params:{avatar:e.value.avatar}}))return;S.value.show=!1;const i=x.VueCookies.get("userInfo");delete i.avatar,x.VueCookies.set("userInfo",i,0),F("updateAvatar")};return(I,i)=>{const m=f("el-form-item"),h=f("el-form"),q=f("Dialog");return l(),p("div",null,[r(q,{show:S.value.show,title:S.value.title,buttons:S.value.buttons,width:"500px",showCancel:!0,onClose:i[2]||(i[2]=R=>S.value.show=!1)},{default:d(()=>[r(h,{model:e.value,ref_key:"formDataRef",ref:_,"label-width":"80px",onSubmit:i[1]||(i[1]=X(()=>{},["prevent"]))},{default:d(()=>[r(m,{label:"昵称",prop:""},{default:d(()=>[E(N(e.value.nickName),1)]),_:1}),r(m,{label:"头像",prop:""},{default:d(()=>[r(fe,{modelValue:e.value.avatar,"onUpdate:modelValue":i[0]||(i[0]=R=>e.value.avatar=R)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},we=t("span",{class:"iconfont icon-password"},null,-1),ge=t("span",{class:"iconfont icon-password"},null,-1),ye={__name:"UpdatePassword",setup(w,{expose:g}){const{proxy:F}=G(),x={updatePassword:"updatePassword"},u=v({}),e=v(),_=(i,m,h)=>{m!==u.value.rePassword?h(new Error(i.message)):h()},A={password:[{required:!0,message:"请输入密码"},{validator:F.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],rePassword:[{required:!0,message:"请再次输入密码"},{validator:_,message:"两次输入的密码不一致"}]};g({show:()=>{z.value.show=!0,Y(()=>{e.value.resetFields(),u.value={}})}});const z=v({show:!1,title:"修改密码",buttons:[{type:"primary",text:"确定",click:i=>{I()}}]}),I=async()=>{e.value.validate(async i=>{!i||!await F.Request({url:x.updatePassword,params:{password:u.value.password}})||(z.value.show=!1,F.Message.success("密码修改成功"))})};return(i,m)=>{const h=f("el-input"),q=f("el-form-item"),R=f("el-form"),n=f("Dialog");return l(),p("div",null,[r(n,{show:z.value.show,title:z.value.title,buttons:z.value.buttons,width:"500px",showCancel:!0,onClose:m[3]||(m[3]=o=>z.value.show=!1)},{default:d(()=>[r(R,{model:u.value,rules:A,ref_key:"formDataRef",ref:e,"label-width":"80px",onSubmit:m[2]||(m[2]=X(()=>{},["prevent"]))},{default:d(()=>[r(q,{label:"新密码",prop:"password"},{default:d(()=>[r(h,{type:"password",size:"large",placeholder:"请输入密码",modelValue:u.value.password,"onUpdate:modelValue":m[0]||(m[0]=o=>u.value.password=o),"show-password":""},{prefix:d(()=>[we]),_:1},8,["modelValue"])]),_:1}),r(q,{label:"确认密码",prop:"rePassword"},{default:d(()=>[r(h,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:u.value.rePassword,"onUpdate:modelValue":m[1]||(m[1]=o=>u.value.rePassword=o),"show-password":""},{prefix:d(()=>[ge]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}};const ke=w=>(Z("data-v-c4b41b7f"),w=w(),ee(),w),be={class:"uploader-panel"},Ce=ke(()=>t("div",{class:"uploader-title"},[t("span",null,"上传任务"),t("span",{class:"tips"},"（仅展示本次上传任务）")],-1)),Se={class:"file-list"},$e={class:"file-item"},Pe={class:"upload-panel"},Ue={class:"file-name"},Fe={class:"progress"},xe={class:"upload-status"},Ie={key:0,class:"upload-info"},Re={class:"op"},Ve={class:"op-btn"},Ae={key:0},ze={key:0},De={__name:"Uploader",emits:["uploadCallback"],setup(w,{expose:g,emit:F}){const{proxy:x}=G(),u={upload:"/file/uploadFile"},e={emptyfile:{value:"emptyfile",desc:"文件为空",color:"#F75000",icon:"close"},fail:{value:"fail",desc:"上传失败",color:"#F75000",icon:"close"},init:{value:"init",desc:"解析中",color:"#e6a23c",icon:"clock"},uploading:{value:"uploading",desc:"上传中",color:"#409eff",icon:"upload"},upload_finish:{value:"upload_finish",desc:"上传完成",color:"#67c23a",icon:"ok"},upload_seconds:{value:"upload_seconds",desc:"秒传",color:"#67c23a",icon:"ok"}},_=1024*512,A=v([]),S=v([]);g({addFile:async(n,o)=>{const s={file:n,uid:n.uid,md5Progress:0,md5:null,fileName:n.name,status:e.init.value,uploadSize:0,totalSize:n.size,uploadProgress:0,pause:!1,chunkIndex:0,filePid:o,errorMsg:null};if(A.value.unshift(s),s.totalSize==0){s.status=e.emptyfile.value;return}let $=await q(s);$!=null&&h($)}});const I=n=>{let o=R(n);o.pause=!1,h(n,o.chunkIndex)},i=n=>{let o=R(n);o.pause=!0},m=(n,o)=>{S.value.push(n),A.value.splice(o,1)},h=async(n,o)=>{o=o||0;let s=R(n);const $=s.file,y=s.totalSize,a=Math.ceil(y/_);for(let P=o;P<a;P++){let U=S.value.indexOf(n);if(U!=-1){S.value.splice(U,1);break}if(s=R(n),s.pause)break;let k=P*_,c=k+_>=y?y:k+_,b=$.slice(k,c),V=await x.Request({url:u.upload,showLoading:!1,dataType:"file",params:{file:b,fileName:$.name,fileMd5:s.md5,chunkIndex:P,chunks:a,fileId:s.fileId,filePid:s.filePid},showError:!1,errorCallback:D=>{s.status=e.fail.value,s.errorMsg=D},uploadProgressCallback:D=>{let L=D.loaded;L>y&&(L=y),s.uploadSize=P*_+L,s.uploadProgress=Math.floor(s.uploadSize/y*100)}});if(V==null)break;if(s.fileId=V.data.fileId,s.status=e[V.data.status].value,s.chunkIndex=P,V.data.status==e.upload_seconds.value||V.data.status==e.upload_finish.value){s.uploadProgress=100,F("uploadCallback");break}}},q=n=>{let o=n.file,s=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,$=Math.ceil(o.size/_),y=0,a=new ue.ArrayBuffer,P=new FileReader;new Date().getTime();let U=()=>{let k=y*_,c=k+_>=o.size?o.size:k+_;P.readAsArrayBuffer(s.call(o,k,c))};return U(),new Promise((k,c)=>{let b=R(o.uid);P.onload=V=>{if(a.append(V.target.result),y++,y<$){let D=Math.floor(y/$*100);b.md5Progress=D,U()}else{let D=a.end();a.destroy(),b.md5Progress=100,b.status=e.uploading.value,b.md5=D,k(n.uid)}},P.onerror=()=>{b.md5Progress=-1,b.status=e.fail.value,k(n.uid)}}).catch(k=>null)},R=n=>A.value.find(s=>s.file.uid===n);return(n,o)=>{const s=f("el-progress"),$=f("icon"),y=f("NoData");return l(),p("div",be,[Ce,t("div",Se,[(l(!0),p(j,null,J(A.value,(a,P)=>(l(),p("div",$e,[t("div",Pe,[t("div",Ue,N(a.fileName),1),t("div",Fe,[a.status==e.uploading.value||a.status==e.upload_seconds.value||a.status==e.upload_finish.value?(l(),B(s,{key:0,percentage:a.uploadProgress},null,8,["percentage"])):M("",!0)]),t("div",xe,[t("span",{class:T(["iconfont","icon-"+e[a.status].icon]),style:W({color:e[a.status].color})},null,6),t("span",{class:"status",style:W({color:e[a.status].color})},N(a.status=="fail"?a.errorMsg:e[a.status].desc),5),a.status==e.uploading.value?(l(),p("span",Ie,N(O(x).Utils.size2Str(a.uploadSize))+"/"+N(O(x).Utils.size2Str(a.totalSize)),1)):M("",!0)])]),t("div",Re,[a.status==e.init.value?(l(),B(s,{key:0,type:"circle",width:50,percentage:a.md5Progress},null,8,["percentage"])):M("",!0),t("div",Ve,[a.status===e.uploading.value?(l(),p("span",Ae,[a.pause?(l(),B($,{key:0,width:28,class:"btn-item",iconName:"upload",title:"上传",onClick:U=>I(a.uid)},null,8,["onClick"])):(l(),B($,{key:1,width:28,class:"btn-item",iconName:"pause",title:"暂停",onClick:U=>i(a.uid)},null,8,["onClick"]))])):M("",!0),a.status!=e.init.value&&a.status!=e.upload_finish.value&&a.status!=e.upload_seconds.value?(l(),B($,{key:1,width:28,class:"del btn-item",iconName:"del",title:"删除",onClick:U=>m(a.uid,P)},null,8,["onClick"])):M("",!0),a.status==e.upload_finish.value||a.status==e.upload_seconds.value?(l(),B($,{key:2,width:28,class:"clean btn-item",iconName:"clean",title:"清除",onClick:U=>m(a.uid,P)},null,8,["onClick"])):M("",!0)])])]))),256)),A.value.length==0?(l(),p("div",ze,[r(y,{msg:"暂无上传任务"})])):M("",!0)])])}}},Ne=te(De,[["__scopeId","data-v-c4b41b7f"]]);const Q=w=>(Z("data-v-832ae474"),w=w(),ee(),w),Me={class:"framework"},qe={class:"header"},Le=Q(()=>t("div",{class:"logo"},[t("span",{class:"iconfont icon-pan"}),t("span",{class:"name"},"Easy云盘")],-1)),Be={class:"right-panel"},Te=Q(()=>t("span",{class:"iconfont icon-transfer"},null,-1)),je={class:"user-info"},Ee={class:"avatar"},Ge={class:"nick-name"},Oe={class:"body"},Je={class:"left-sider"},He={class:"menu-list"},Ke=["onClick"],Qe={class:"text"},We={class:"menu-sub-list"},Xe=["onClick"],Ye={class:"text"},Ze={key:0,class:"tips"},et={class:"space-info"},tt=Q(()=>t("div",null,"空间使用",-1)),at={class:"percent"},st={class:"space-use"},ot={class:"use"},lt={class:"body-content"},nt={__name:"Framework",setup(w){const{proxy:g}=G(),F=H(),x=K(),u={getUseSpace:"/getUseSpace",logout:"/logout"},e=v(!1),_=v(),A=c=>{const{file:b,filePid:V}=c;e.value=!0,_.value.addFile(b,V)},S=v(),z=()=>{Y(()=>{S.value.reload(),k()})},I=v(0),i=v(g.VueCookies.get("userInfo")),m=[{icon:"cloude",name:"首页",menuCode:"main",path:"/main/all",allShow:!0,children:[{icon:"all",name:"全部",category:"all",path:"/main/all"},{icon:"video",name:"视频",category:"video",path:"/main/video"},{icon:"music",name:"音频",category:"music",path:"/main/music"},{icon:"image",name:"图片",category:"image",path:"/main/image"},{icon:"doc",name:"文档",category:"doc",path:"/main/doc"},{icon:"more",name:"其他",category:"others",path:"/main/others"}]},{path:"/myshare",icon:"share",name:"分享",menuCode:"share",allShow:!0,children:[{name:"分享记录",path:"/myshare"}]},{path:"/recycle",icon:"del",name:"回收站",menuCode:"recycle",tips:"回收站为你保存10天内删除的文件",allShow:!0,children:[{name:"删除的文件",path:"/recycle"}]},{path:"/settings/fileList",icon:"settings",name:"设置",menuCode:"settings",allShow:!1,children:[{name:"用户文件",path:"/settings/fileList"},{name:"用户管理",path:"/settings/userList"},{path:"/settings/sysSetting",name:"系统设置"}]}],h=v({}),q=v(),R=c=>{!c.path||c.menuCode==h.value.menuCode||F.push(c.path)},n=(c,b)=>{const V=m.find(D=>D.menuCode===c);h.value=V,q.value=b};re(()=>x,(c,b)=>{c.meta.menuCode&&n(c.meta.menuCode,c.path)},{immediate:!0,deep:!0});const o=v(),s=()=>{o.value.show(i.value)},$=()=>{i.value=g.VueCookies.get("userInfo"),I.value=new Date().getTime()},y=v(),a=()=>{y.value.show()},P=()=>{g.Confirm("你确定要删除退出吗",async()=>{await g.Request({url:u.logout})&&(g.VueCookies.remove("userInfo"),F.push("/login"))})},U=v({useSpace:0,totalSpace:1}),k=async()=>{let c=await g.Request({url:u.getUseSpace,showLoading:!1});c&&(U.value=c.data)};return k(),(c,b)=>{const V=f("el-popover"),D=f("Avatar"),L=f("el-dropdown-item"),ae=f("el-dropdown-menu"),se=f("el-dropdown"),oe=f("el-progress"),le=f("router-view");return l(),p("div",Me,[t("div",qe,[Le,t("div",Be,[r(V,{width:800,trigger:"click",visible:e.value,"onUpdate:visible":b[0]||(b[0]=C=>e.value=C),offset:20,transition:"none","hide-after":0,"popper-style":{padding:"0px"}},{reference:d(()=>[Te]),default:d(()=>[r(Ne,{ref_key:"uploaderRef",ref:_,onUploadCallback:z},null,512)]),_:1},8,["visible"]),r(se,null,{dropdown:d(()=>[r(ae,null,{default:d(()=>[r(L,{onClick:s},{default:d(()=>[E(" 修改头像 ")]),_:1}),r(L,{onClick:a},{default:d(()=>[E(" 修改密码 ")]),_:1}),r(L,{onClick:P},{default:d(()=>[E(" 退出 ")]),_:1})]),_:1})]),default:d(()=>[t("div",je,[t("div",Ee,[r(D,{userId:i.value.userId,avatar:i.value.avatar,timestamp:I.value,width:46},null,8,["userId","avatar","timestamp"])]),t("span",Ge,N(i.value.nickName),1)])]),_:1})])]),t("div",Oe,[t("div",Je,[t("div",He,[(l(),p(j,null,J(m,C=>(l(),p(j,null,[C.allShow||!C.allShow&&i.value.admin?(l(),p("div",{key:0,onClick:ne=>R(C),class:T(["menu-item",C.menuCode==h.value.menuCode?"active":""])},[t("div",{class:T(["iconfont","icon-"+C.icon])},null,2),t("div",Qe,N(C.name),1)],10,Ke)):M("",!0)],64))),64))]),t("div",We,[(l(!0),p(j,null,J(h.value.children,C=>(l(),p("div",{onClick:ne=>R(C),class:T(["menu-item-sub",q.value==C.path?"active":""])},[C.icon?(l(),p("span",{key:0,class:T(["iconfont","icon-"+C.icon])},null,2)):M("",!0),t("span",Ye,N(C.name),1)],10,Xe))),256)),h.value&&h.value.tips?(l(),p("div",Ze,N(h.value.tips),1)):M("",!0),t("div",et,[tt,t("div",at,[r(oe,{percentage:Math.floor(U.value.useSpace/U.value.totalSpace*1e4)/100,color:"#409eff"},null,8,["percentage"])]),t("div",st,[t("div",ot,N(O(g).Utils.size2Str(U.value.useSpace))+"/ "+N(O(g).Utils.size2Str(U.value.totalSpace)),1),t("div",{class:"iconfont icon-refresh",onClick:k})])])])]),t("div",lt,[r(le,null,{default:d(({Component:C})=>[(l(),B(ie(C),{onAddFile:A,ref_key:"routerViewRef",ref:S,onReload:k},null,544))]),_:1})])]),r(he,{ref_key:"updateAvatarRef",ref:o,onUpdateAvatar:$},null,512),r(ye,{ref_key:"updatePasswordRef",ref:y},null,512)])}}},Nt=te(nt,[["__scopeId","data-v-832ae474"]]);export{Nt as default};
